@page "/despacho"

@using System;
@using System.Text.RegularExpressions;

@using ControWell.Client.BalanceComponents
@using ControWell.Client.Services.CarroTanqueService;
@using ControWell.Client.Services.GuiaService;
@using ControWell.Client.Services.SelloService;
@using ControWell.Client.Services.OfertaDiariaService
@using ControWell.Client.Services.FormatoCargaService;

@using System.Data
@using ControWell.Shared
@using System.Net.Http.Json
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject IFormatoCargaService FormatoCargaService
@inject ICarroTanqueService CarroTanqueService
@inject IGuiaService GuiaService
@inject ISelloService SelloService
@inject IOfertaDiariaService OfertaDiariaService

@inject SweetAlertService Swal

@using MatBlazor

<div style="width:100%; height:100%;display:flex; justify-content:center; align-items:center; background-color:lightgray">

 @* PARTE IZQUIERDA*@
  <div style="width:40%; height:100%; background-color:lightgreen; border-radius:8px; border:medium">
      <div style="height:80%">
        <div style="margin-bottom: 30px;margin-top:30px">
           <div style="width:100%">
            <p>
             <MatDatePicker @bind-Value="@Date1" Format="MMMM dd, yyyy"  Style="background-color:whitesmoke; margin-bottom:15px;margin-left:15px" Outlined></MatDatePicker>
            </p>
         @* <MatButton Outlined OnClick="@(_ =>{ Date1 = DateTime.Now;})">
              Hoy
            </MatButton>*@
           </div>
           <MatTextField @bind-Value="@LugarExpedicionValue" Label="Lugar de Expedición"  Style="background-color:whitesmoke; margin-bottom:15px;margin-left:15px" ></MatTextField>
           <MatTextField @bind-Value="@PlantaProductoraValue" Label="Planta productora"  Style="background-color:whitesmoke; margin-bottom:15px;margin-left:15px"></MatTextField>
           <MatTextField @bind-Value="@PorductoCargadoValue" Label="Producto Cargado"  Style="background-color:whitesmoke; margin-bottom:15px;margin-left:15px" ></MatTextField>
        </div> 
        <div>
            <MatSelect Label="Selecciona Tanque" @bind-Value="valueSello" Style="background-color:whitesmoke; margin-bottom:15px;margin-left:15px" Outlined>
              <MatOptionString Disabled Style="color:blue" Value=""></MatOptionString>
           </MatSelect>

           <span>@valueSello</span>
        </div>
     </div>
     <div style="height:20%">
        <div class="flex-component">
          <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal" style="margin-right:25px">
            Previsualizar Guia
          </button>      
          <button type="button" @onclick="CargarGuia" class="btn btn-info" >
            Generar Guia
          </button>
        </div>
     </div>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    
                        @*lateral izquierdo*@
                        <div style="background-color:beige; width:5%; height:100%; border-right-style:dashed; border-width: thin">
                            <span class="circulo" />
                        </div>

                        @*cuerpo*@
                        <div style="background-color:floralwhite; width:100%; height:97%; display:flex; justify-content:center;align-items:center">
                            <div style="width:98%; height:95%; border-radius:4px ;background-color:rgba(aqua,0.2); border-width: thin; border-style:solid">
                                <h6 style="width:100%; display:flex; justify-content:center; align-items:center; font-size:20px ">GUIA PARA TRANSPORTAR PRODUCTOS DERIVADOS DEL PETROLEO</h6>
                                <h6 style="width:100%; display:flex; justify-content:center; align-items:center; font-size:17px">ECOPETROL S.A</h6>

                                @*Codigo fila *@
                                <div class="flex-component" style="width:100%;height:5%; margin-bottom:7px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px ;  background-color:transparent ">
                                        <div class="flex-component" style="width:100%;height:100%; background-color:transparent ">
                                            <div style="width:70%;height:100%">
                                            </div>
                                            <div class="flex-component" style="width:30%;height:100%">
                                            @if(valueGuia.Length > 0)
                                            {                                                
                                              <h5>N°</h5>
                                              <h5 style="margin-left:8px"> @valueGuia.Substring(0,3)</h5>
                                              <h5 style="color:indianred; margin-left:7px">@valueGuia.Substring(3,10)</h5>
                                            }else{
                                              <h5>N°</h5>
                                              <h5 style="margin-left:8px"> XXX</h5>
                                              <h5 style="color:indianred; margin-left:7px">-XXXXXXX</h5>
                                            }

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @*primera fila *@
                                <div class="flex-component" style="width:100%;height:6%; margin-bottom:10px; background-color:transparent ">
                                    <div class="flex-component"
                                         style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid;  background-color:floralwhite ">
                                        <div style="width:40%;height:100%; border-right:2px solid  ">
                                            <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                LUGAR Y FECHA DE EXPEDICION
                                            </p>
                                            <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                @LugarExpedicionValue, @Date1
                                            </p>
                                        </div>
                                        <div style="width:30%;height:100%; border-right:2px solid  ">
                                            <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                PLANTA O CAMPO PRODUCTOR
                                            </p>
                                            <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px;  font-family:'Courier New', monospace;">
                                                @PlantaProductoraValue
                                            </p>
                                        </div>
                                        <div style="width:30%;height:100%; ">
                                            <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                FACTURA O REMISION N°
                                            </p>
                                              @if(valueOfertaDiaria.Length>0){
                                               <p style="
                                                 position:relative;
                                                 top:5px; font-size:18px;
                                                 height:70%;text-align:right;
                                                 margin-top: 0px;
                                                 margin-right:10px;
                                                 font-family:'Courier New', monospace;
                                                 ">
                                                 @ofertaDiaria.CodigoRuta
                                               </p>
                                              
                                              }else{
                                               <p style="
                                                 position:relative;
                                                 top:5px; font-size:18px;
                                                 height:70%;text-align:right;
                                                 margin-top: 0px;
                                                 margin-right:10px;
                                                 font-family:'Courier New', monospace;
                                                 ">
                                                 xxxx-x
                                               </p>
                                              }
                                        </div>
                                    </div>
                                </div>
                                @* segunda division *@
                                <div class="flex-component" style="width:100%;height:12%; margin-bottom:10px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid; ">
                                        <div class="flex-component" style="width:100%;height:50%; border-bottom: 1px solid; background-color:transparent ">
                                            <div style="width:75%;height:100%; border-right:2px solid ;">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    DESPACHADO A:
                                                </p>
                                                @if(valueOfertaDiaria.Length>0){
                                                <p style="position:relative;top:5px; font-size:14px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Destino
                                                </p>
                                                }else{
                                                  <p style="position:relative;top:5px; font-size:14px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    XXXXXXXXXXXXXXXXX
                                                  </p>
                                                }
                                            </div>
                                            <div style="width:25%;height:100%; ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    CODIGO SICOM
                                                </p>
                                                <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @SICOMValue
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex-component" style="width:100%;height:50%; border-width: thin; background-color:transparent ">
                                            <div style="width:75%;height:100%; border-right: 2px solid  ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    DIRECCION
                                                </p>
                                                <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @DireccionValue
                                                </p>
                                            </div>
                                            <div style="width:25%;height:100% ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    CIUDAD
                                                </p>
                                                <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @CiudadValue
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @* tercera division *@
                                <div class="flex-component" style="width:100%;height:12%; margin-bottom:10px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid; ">
                                        <div class="flex-component" style="width:100%;height:50%; border-bottom: 1px solid; background-color:transparent ">
                                            <div style="width:75%;height:100%; border-right:2px solid ;">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    NOMBRE DEL CONDUCTOR
                                                </p>
                                                 @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.NombreConductor
                                                  </p>
                                                 }else{
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    xxxxxx xxxxxx xxxxxxxx
                                                  </p>
                                                  }

                                            </div>
                                            <div style="width:25%;height:100%; ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    CEDULA
                                                </p>
                                                @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Cedula
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }

                                            </div>
                                        </div>
                                        <div class="flex-component" style="width:100%;height:50%; border-width: thin; background-color:transparent ">
                                            <div style="width:50%;height:100%; border-right: 2px solid  ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    EMPRESA TRANSPORTADORA
                                                </p>
                                                 @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.EmpresaTransportadora
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }

                                            </div>
                                            <div style="width:25%;height:100%;border-right: 2px solid ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    PLACAS DEL CABEZOTE
                                                </p>
                                                 @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Placa
                                                  </p>
                                                  }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }
                                            </div>
                                            <div style="width:25%;height:100% ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    PLACAS DEL TANQUE
                                                </p>
                                                @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Tanque
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @* cuarta division *@
                                <div class="flex-component" style="width:100%;height:12%; margin-bottom:10px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid; ">
                                        <div class="flex-component" style="width:100%;height:50%; border-bottom: 1px solid; background-color:transparent ">
                                            <div style="width:45%;height:100%; border-right:2px solid;">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    LUGAR DE ORIGEN
                                                </p>
                                                @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Origen
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }
                                            </div>
                                            <div style="width:40%;height:100%; border-right:2px solid; border-top:2px solid  ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    FECHA Y HORA DE SALIDA
                                                </p>
                                                @if(HoraSalidaValue != null){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @HoraSalidaValue
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXX
                                                   </p>
                                                  }
                                            </div>
                                            <div style="width:15%;height:100%; border-top: 2px solid; border-right:2px solid  ">
                                                @if(HoraSalidaValue != null){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @HoraSalidaValue
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXX
                                                   </p>
                                                  }
                                            </div>
                                        </div>
                                        <div class="flex-component" style="width:100%;height:50%; border-width: thin; background-color:transparent ">
                                            <div style="width:45%;height:100%; border-right: 2px solid  ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    LUGAR DE DESTINO
                                                </p>
                                                @if(valueOfertaDiaria.Length>0){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @ofertaDiaria.Destino
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }
                                            </div>
                                            <div style="width:55%;height:100%; border-bottom: 2px solid; border-right:2px solid;  ">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    HORAS DE VIGENCIA
                                                </p>
                                                @if(HorasVigenciaValue != ""){
                                                  <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    @HorasVigenciaValue
                                                  </p>
                                                 }else{
                                                   <p style="position:relative;top:5px; font-size:12px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                     XXXXXXXXX
                                                   </p>
                                                  }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @* quinta division *@
                                <div class="flex-component" style="width:100%;height:20%; margin-bottom:10px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid; ">
                                        <div class="flex-component" style="width:100%;height:17%; border-bottom: 1px solid; background-color:transparent ">
                                            <div style="width:65%;height:100%; border-right:2px solid;">
                                                <p style="position:relative;top:5px; font-size:10px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    DESCRIPCION DEL PRODUCTO
                                                </p>
                                            </div>
                                            <div style="width:35%;height:100%;">
                                                <p style="position:relative;top:5px; font-size:10px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    VOLUMEN EN BARRILES O GALONES
                                                </p>
                                            </div>

                                        </div>
                                        <div class="flex-component" style="width:100%;height:83%; border-width: thin; background-color:transparent ">
                                            <div style="width:65%;height:100%; border-right: 2px solid  ">
                                            </div>
                                            <div style="width:35%;height:100%; ">
                                                <p style="position:relative;top:5px; font-size:10px; height:70%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    10782,56 Gls
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @* sexta division *@
                                <div class="flex-component" style="width:100%;height:7.3%; margin-bottom:10px;background-color:transparent ">
                                    <div style="width:99%;height:100%; border-radius:7px; border-width: thin; border-style:solid; ">
                                        <div class="flex-component" style="width:100%;height:100%; background-color:transparent ">
                                            <div style="width:75%;height:100%; border-right: solid">
                                                <p style="position:relative; top:0px;left:4px;font-size:8px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    OBSERVACIONES
                                                </p>
                                                <p style="position:relative;top:5px; font-size:12px; height:100%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                    ASDASDASDASAS
                                                </p>
                                            </div>
                                            <div style="width:25%;height:100%">
                                                <p style="position:relative; top:0px;left:4px;font-size:7px; letter-spacing:1px; height:30%; margin-bottom:0px">
                                                    ZONA DE FRONTERA
                                                </p>
                                                <p style="position:relative;top:5px; font-size:10px; height:100%;text-align:center;margin-top: 0px; font-family:'Courier New', monospace;">
                                                </p>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div style="background-color:beige; width:5%; height:100%; border-left-style:dashed; border-width: thin">
                        </div>
                 
                </div>
            </div>
        </div>
  </div>

  @*PARTE DERECHA*@
  <div style="width:35%; height:100%; background-color:antiquewhite">
     <div style="margin-top:30px; margin-bottom:30px;margin-left:10px">
      <MatSelect Label="Selecciona un Camión" @bind-Value="value1" Outlined Style="background-color:whitesmoke; border-radius:8px">
        <MatOptionString></MatOptionString>
         @foreach(var CarroTanque in CarroTanques)
         {
           <MatOptionString Value="@CarroTanque.Capacidad">@CarroTanque.TipoVehiculo</MatOptionString>
         }
       </MatSelect>
       <span>@value1</span>
       <MatProgressCircle Closed="LoadingCarroTanque" Size="MatProgressCircleSize.Small" />

      </div>
        <div style="margin-bottom: 30px;margin-left:10px">
            <MatSelect Label="Selecciona una Guia" @bind-Value="valueGuia" Outlined Style="background-color:whitesmoke; margin-bottom:15px">
            <MatOptionString></MatOptionString>
            @foreach (var Guia in Guias)
            {
                @if(Guia.Estado == 1)
                {   
                 <MatOptionString Value="@Guia.NumeroGuia">@Guia.NumeroGuia</MatOptionString>
                }else if(Guia.Estado == 2) {
                    <MatOptionString Disabled Style="color:blue" Value="@Guia.NumeroGuia">@Guia.NumeroGuia</MatOptionString>
                }else
                {
                    <MatOptionString Disabled Style="color:darkred" Value="@Guia.NumeroGuia">@Guia.NumeroGuia</MatOptionString>
                }
            }
        </MatSelect>

        @*<span>@valueGuia</span>*@
        <MatProgressCircle Closed="LoadingGuias" Size="MatProgressCircleSize.Small" />
    </div>   
     <div class="flex-component" style="width:100%; margin-bottom: 30px;margin-left:10px">
            <MatSelect Label="Selecciona maximo 6 sellos" @bind-Value="valueSelloLabel" Outlined Style="background-color:whitesmoke; border-radius:8px">
            <MatOptionString></MatOptionString>
            @foreach (var Sello in Sellos)
            {
                    @if (Sello.Estado == 1 && !arraySellos.Any(E => E == $"{@Sello.IndiceSello}-{@Sello.NumeroSello}"))
                {   
@*                 <MatOptionString Value="@Sello.IndiceSello">@Sello.IndiceSello-@Sello.NumeroSello</MatOptionStrin*@

                    <MatOptionString Style="width:100%;" Value="@Sello.IndiceSello">
                        <div style="display:flex; justify-content:space-between;align-items:center; width:100%">
                          <div style="margin-right:15px">
                            @Sello.IndiceSello-@Sello.NumeroSello
                          </div>
                          <div >
                            <button style="text-align:center; border:none;background-color:transparent" @onclick="()=>AddSello(Sello)">
                              <MatIcon Style="color:cornflowerblue" Icon="@MatIconNames.Add_circle" ></MatIcon>
                            </button>
                          </div>
                        </div>
                    </MatOptionString>

                }
     @*           else if(Sello.Estado == 2) {
                    <MatOptionString Disabled Style="color:blue">@Sello.IndiceSello-@Sello.NumeroSello</MatOptionString>
                }else
                {
                    <MatOptionString Disabled Style="color:darkred">@Sello.IndiceSello-@Sello.NumeroSello</MatOptionString>
                };*@
            }
        </MatSelect>

        @if(arraySellos.Length > 0)
        {
                <div style="display:flex; justify-content:center; align-items: center; width:100%;">
                    <button type="button"
                        class="btn btn-warning"
                        data-bs-toggle="modal"
                        data-bs-target="#exampleModalSello"
                        style="font-size:18px"
                        data-toggle="tooltip" title="Ver Sellos"
                    >
                        <i class="fa-solid fa-eye"></i>
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="exampleModalSello" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Sellos a Utilizar:</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    @for(i=0; i< arraySellos.Length;i++)
                                    {
                                      <p style="color:mediumblue">@arraySellos[i]</p>
                                    }
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        }
        @*<span>@valueSello</span>*@
        <MatProgressCircle Closed="LoadingSellos" Size="MatProgressCircleSize.Small" />

     </div>
        <div style="margin-bottom: 30px;margin-left:10px">
            <div style="width:100%;margin-left:0">
              <MatSelect Label="Selecciona placa" @bind-Value="valueOfertaDiaria" Outlined Style="background-color:whitesmoke;margin-left:0">
                <MatOptionString></MatOptionString>
                @foreach (var OfertaDiaria in OfertaDiarias)
                {
                 @if(OfertaDiaria.disponible=="1")
                  {
                    <MatOptionString Value="@OfertaDiaria.Id.ToString()">@OfertaDiaria.Placa</MatOptionString>
                  }else{
                    <MatOptionString Disabled Style="color:darkred">@OfertaDiaria.Placa</MatOptionString>
                  }
                }
              </MatSelect>
              <MatProgressCircle Closed="LoadingOfertaDiaria" Size="MatProgressCircleSize.Small" />
@*            <span>@valueOfertaDiaria</span>*@           
              <MatButton @onclick="BuscarPorPlaca" Outlined>Buscar</MatButton>
            </div>
            <span style="margin-left:5px">@ofertaDiaria.NombreConductor</span>
        </div>      
        <div style="margin-bottom: 30px;margin-left:10px">
            <MatSelect Label="Operario " @bind-Value="valueOperario" Outlined Style="background-color:whitesmoke; border-radius:8px">
                <MatOptionString></MatOptionString>
                   
                @foreach (var Operario in Operarios)
                {
                    <MatOptionString Value="@Operario.Nombre">@Operario.Nombre</MatOptionString> 
                }
            </MatSelect>
@*            <span>@valueOperario</span>
*@            <MatProgressCircle Closed="LoadingOperarios" Size="MatProgressCircleSize.Small" />

        </div>

        <div style="margin-bottom: 30px;margin-left:10px">
            <MatSelect Label="Destino" @bind-Value="valueDestino" Outlined Style="background-color:whitesmoke; border-radius:8px">
                <MatOptionString></MatOptionString>
                   
                @foreach (var Destino in Destinos)
                {
                    <MatOptionString Value="@Destino.Nombre">@Destino.Nombre</MatOptionString> 
                }
            </MatSelect>
@*            <span>@valueDestino</span>
*@            <MatProgressCircle Closed="LoadingDestino" Size="MatProgressCircleSize.Small" />
        </div>
   </div>
@*   PARTE DERECHA*@   
   <div style="width:25%; height:100%; background-color:antiquewhite">
        <div style="margin-top:30px; margin-bottom:30px">
           <MatTextField @bind-Value="@CiudadValue" Label="Ciudad"></MatTextField>
        </div>    
        <div style="margin-bottom: 30px">
           <MatTextField @bind-Value="@SICOMValue" Label="SICOM"></MatTextField>
        </div>        
        <div style="margin-bottom: 30px">
           <MatTextField @bind-Value="@DireccionValue" Label="Direccion"></MatTextField>
        </div>      
        <div style="margin-bottom: 30px">
           <MatTextField @bind-Value="@HorasVigenciaValue" Label="Horas Vigencia"></MatTextField>
        </div>      
        <div style="margin-bottom: 30px">
           <MatTextField @bind-Value="@HoraEntradaValue" Label="Hora Entrada" PlaceHolder="6:00 Ó 14:00"></MatTextField>
        </div>      
        <div style="margin-bottom: 30px">
           <MatTextField @bind-Value="@HoraSalidaValue" Label="Hora Salida" PlaceHolder="6:00 Ó 14:00"></MatTextField>
        </div>
   </div>
</div>

<style>
    .Guia-view {
        width: 100%;
        height: 90%;
    }

    .guia-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .flex-component {
        display: flex;
        justify-content: center;
        align-items: center;
    }
</style>

@code
{
    int i = 0 ;

    string value1 = "";
    string myStringValue = "";
    string placa = "";

    string valueGuia = "";
    string valueSello = "";
    string valueSelloLabel = "";
    string valueOfertaDiaria = "";
    string valueOperario = "";
    string valueDestino = "";
    string CiudadValue = "GUAMAL-META";
    string SICOMValue = "N/A";
    string DireccionValue = "GUAMAL-META";
    string HorasVigenciaValue = "";
    string LugarExpedicionValue = "APIAY";
    string PlantaProductoraValue = "ECP-REFINERIA APIAY";
    string PorductoCargadoValue = "CRUDO DE MEZCLA";
    DateTime HoraEntradaValue;
    DateTime HoraSalidaValue;

    bool checked1 = true;

    bool EnableCarroTanque = true;
    bool LoadingCarroTanque = false;
    bool EnableGuias = true;
    bool LoadingGuias = false;  
    bool EnableSellos = true;
    bool LoadingSellos = false;
    bool EnableOfertaDiaria = true;
    bool LoadingOfertaDiaria = false; 
    bool EnableOperarios = true;
    bool LoadingOperarios = false;
    bool EnableDestino = true;
    bool LoadingDestino = false;

    public DateTime Date1 { get; set; } = DateTime.Now;
    //public DateTime? Date1 { get; set; } = DateTime.Now.AddDays(-10

    //String[] array = new string[10];
    //array[0] = "Primer valor del array de strings";
    //array[1] = "Segundo valor";

    List<String> list = new List<String>();

    OfertaDiaria ofertaDiaria = new OfertaDiaria();

    public static List<CarroTanque> CarroTanques = new List<CarroTanque>();
    public static List<Guia> Guias = new List<Guia>();
    public static List<Sello> Sellos = new List<Sello>();
    public static List<OfertaDiaria> OfertaDiarias = new List<OfertaDiaria>();
    public static List<Operario> Operarios = new List<Operario>();
    public static List<Destino> Destinos = new List<Destino>();

    public static List<FormatoCarga> FormatoCarroTanquesCargados = new List<FormatoCarga>();


    protected override async Task OnInitializedAsync()
    {
        Console.WriteLine(ofertaDiaria);
        var resultadoCarroTanque = await Http.GetFromJsonAsync<List<CarroTanque>>("api/carrotanque");
        if (resultadoCarroTanque != null)
            CarroTanques = resultadoCarroTanque;
        LoadingCarroTanque = true;
        EnableCarroTanque = false;

        var resultadoGuia = await Http.GetFromJsonAsync<List<Guia>>("api/guia");
        if (resultadoGuia != null)
            Guias = resultadoGuia;
        LoadingGuias = true;
        EnableGuias = false;

        var resultadoSellos = await Http.GetFromJsonAsync<List<Sello>>("api/sello");
        if (resultadoSellos != null)
            Sellos = resultadoSellos;    
        LoadingSellos = true;
        EnableSellos = false;

        var resultadoOfertaDiarias = await Http.GetFromJsonAsync<List<OfertaDiaria>>("api/ofertaDiaria");
        if (resultadoOfertaDiarias != null)
            OfertaDiarias = resultadoOfertaDiarias;   
        LoadingOfertaDiaria = true;
        EnableOfertaDiaria = false;

        var resultadoOperadores = await Http.GetFromJsonAsync<List<Operario>>("api/Operario");
        if (resultadoOperadores != null)
            Operarios = resultadoOperadores;
        LoadingOperarios=true;
        EnableOperarios=false;

        var resultDestino = await Http.GetFromJsonAsync<List<Destino>>($"api/Destino");
        if (resultDestino != null)
            Destinos = resultDestino;
        LoadingDestino = true;
        EnableDestino = false;
    }

    async Task BuscarPorPlaca()
    {
        var id = Int32.Parse(valueOfertaDiaria);

        //var placaSend = Regex.Replace(placa.ToUpper(), @"\s+", "");
        //Console.WriteLine($"placa digitada: {Regex.Replace(placa.ToUpper(), @"\s+", "")}");
        var resultadoPlaca = await Http.GetFromJsonAsync<OfertaDiaria>($"api/ofertaDiaria/{id}");

        if (resultadoPlaca != null)
            ofertaDiaria = resultadoPlaca;

    }

    FormatoCarga formatoCarga = new FormatoCarga();

    public async void CargarGuia()

    {
        formatoCarga.GuiaDeTransporteGTU = valueGuia;
        formatoCarga.OrigenDespacho = ofertaDiaria.Origen;
        formatoCarga.ProductoCargado = PorductoCargadoValue;
        formatoCarga.Cedula = ofertaDiaria.Cedula;
        formatoCarga.NombreConductor = ofertaDiaria.NombreConductor;
        formatoCarga.OrdenDeCargue = ofertaDiaria.CodigoRuta;
        formatoCarga.PlacaCarro = ofertaDiaria.Placa;
        formatoCarga.PlacaTanque = ofertaDiaria.Tanque;
        formatoCarga.DestinoRecibo = ofertaDiaria.Destino;
        formatoCarga.EmpresasTransportadoras = ofertaDiaria.EmpresaTransportadora;
        formatoCarga.SellosInstalados = valueSello;
        formatoCarga.VolumenBrutoObservadoGOV = "pendiente";
        formatoCarga.BSW = "pendiente";
        formatoCarga.Temp = "pendiente";
        formatoCarga.FactorTemp = "pendiente";
        formatoCarga.VolumenNeto = "pendiente";
        formatoCarga.GuiaDeTransporteGTU = valueGuia;
        formatoCarga.CreatedAt = DateTime.Now;
        formatoCarga.Auxiliar = valueOperario;
        formatoCarga.SICOM = SICOMValue;
        formatoCarga.Direccion = DireccionValue;
        formatoCarga.HorasVigencia = HorasVigenciaValue;
        formatoCarga.Ciudad = CiudadValue;
        formatoCarga.HoraEntrada = HoraEntradaValue;
        formatoCarga.HoraSalida = HoraSalidaValue.ToString("hh-mm-ss");
        formatoCarga.FechaCargue = Date1;
        formatoCarga.LugarDestino = valueDestino;
        formatoCarga.LugarExpedicion = LugarExpedicionValue;
        formatoCarga.PlantaProductora = PlantaProductoraValue;

        try
        {
            await FormatoCargaService.CreateFormatoCarga(formatoCarga);
            var resultado = await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Success",
                    Text = "Guardado correctamente",
                    Icon = SweetAlertIcon.Success,
                });
        }
        catch (InvalidCastException e)
        {
            Console.WriteLine(e);

            NavigationManager.NavigateTo("/");
            NavigationManager.NavigateTo("/formatocargalist");
        }
        finally
        {
            await UsarGuia();
            await UsarSellos();
            NavigationManager.NavigateTo("/");
            NavigationManager.NavigateTo("/formatocargalist");
        }
    }

    Guia guia = new Guia();

    async Task UsarGuia()
     {
        @foreach (var Guia in Guias)
        {
            Console.WriteLine("hola desde el for");
            if(Guia.NumeroGuia == valueGuia)
            {
              guia.Id = Guia.Id;
              guia.NumeroGuia = valueGuia;
              guia.Lote = Guia.Lote;
              guia.CreatedAt = Guia.CreatedAt;
              guia.Estado = 2;
              
              await GuiaService.UpdateGuia(guia);
            }
        }

        //NavigationManager.NavigateTo("/");
        //NavigationManager.NavigateTo("/formatocargalist");
    }  
    
    Sello sello = new Sello();

    async Task UsarSellos()
     {
        @for (i=0; i< arraySellos.Length; i++)
        {
          @foreach(var Sello in Sellos)
            {                
             if($"{Sello.IndiceSello}-{Sello.NumeroSello}" == arraySellos[i])
              {
               sello.Id = Sello.Id;
               sello.IndiceSello = Sello.IndiceSello;
               sello.NumeroSello = Sello.NumeroSello;
               sello.Lote = Sello.Lote;
               sello.CreatedAt = Sello.CreatedAt;
               sello.Estado = 2;
              
               await SelloService.UpdateSello(sello); 
             }
            }
        }

        //NavigationManager.NavigateTo("/");
        //NavigationManager.NavigateTo("/formatocargalist");
    }

    string[] arraySellos = new string[6];
    int index = 0;

    public void AddSello(Sello selloRecibido)
    {
        if (index > 6)
        {
            Console.WriteLine("numero maximo de sellos");

            //MessageBox.Show("Llego al limite");
            return;
        }

        arraySellos[index] = $"{selloRecibido.IndiceSello}-{selloRecibido.NumeroSello}";
        valueSello = Enumerable.Range(1, 10).Aggregate(arraySellos[index], (acc, x) => acc + x);

        for (i = 0; i < arraySellos.Length; i++)
        {
          Console.WriteLine(arraySellos[i]);
            
        }

        index++;
    }
 
}

